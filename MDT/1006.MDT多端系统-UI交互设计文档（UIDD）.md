# MDT多端系统 - UI交互设计文档 (UIDD)

## 1. 文档概述
### 1.1 设计目标
规范MDT多端系统的界面设计与交互逻辑，确保会诊助理与专家端操作的高效性、一致性与容错性。重点解决多角色协同、实时语音转录、AI生成内容确认等复杂场景的交互体验。

### 1.2 适用范围
本文档适用于MDT多端系统的UI设计与前端开发，覆盖：
*   **会诊助理端**：PC Web管理后台。
*   **会诊专家端**：PC Web / Pad Web 工作台。

### 1.3 用户体验原则
*   **高效协同**：在多端同步操作时，提供毫秒级的状态反馈。
*   **清晰引导**：通过单向Tab解锁机制，引导用户按标准流程操作。
*   **极简输入**：利用AI辅助（选择优于输入），减少医学文书的录入成本。

## 2. 全局交互规范
### 2.1 布局与导航
*   **助理端**：左侧一级导航 + 顶部面包屑/用户信息 + 右侧内容工作区。
*   **专家端**：顶部轻量级导航（Logo+切换） + 中央卡片式任务流 + 沉浸式详情页。

### 2.2 通用交互组件
*   **状态标签 (Build)**：统一色彩体系（进行中-蓝，已完成-绿，警告/拒绝-红，不可用-灰）。
*   **二次确认弹窗**：
    *   **普通确认**：常规对话框（如取消草稿）。
    *   **醒目警告**：红色对所有误操作后果严重的场景（如取消任务、拒绝邀请）进行强阻断提示。
*   **实时反馈**：结合WebSocket，使用顶部通告栏或局部Toast展示“专家xxx已提交意见”等动态。

## 3. 会诊助理后台 (PC Web) 交互设计

### 3.1 任务列表管理
#### 3.1.1 页面布局框架
*   **顶部筛选区**：
    *   **搜索框**：支持`患者姓名`模糊搜索。
    *   **日期筛选**：`开始日期` - `结束日期` 选择器。
    *   **视图切换Tab**：
        1.  `待会诊` (默认选中，带数字角标，如 "待会诊(3)")。
        2.  `已会诊` (历史归档数据)。
        3.  `超期/取消` (异常任务回收站)。

#### 3.1.2 待会诊列表 (宽卡片设计)
*   **设计目标**：强调任务的**时效性**与**准备就绪度**。
*   **卡片结构**：
    *   **【左侧】时间与患者**：
        *   **第一行**：`会诊时间` (字号 16px, 加粗, 黑色)。
        *   **第二行**：`患者姓名` | `性别` | `年龄` | `主诉` (单行截断，Hover显示完整Tooltip)。
    *   **【中部】专家响应状态**：
        *   **进度展示**：可视化进度条或分数 (如 "已接受 2/3")。
        *   **详情气泡 (Hover触发)**：展示邀请名单列表。
            *   <font color="green">● 李专家 (已接受)</font>
            *   <font color="red">● 王专家 (已拒绝)</font>
            *   <font color="gray">● 张专家 (未响应)</font>
    *   **【右侧】操作区**：
        *   `【进入会诊】` (主按钮)：根据当前时间高亮；若未到时间可显示为次级样式。
        *   `【修改】`：跳转至编辑页。
        *   `【取消】` (文本按钮, 红色)：点击触发高风险警示。

#### 3.1.3 交互细节
*   **取消任务交互**：
    *   点击【取消】 -> 弹出 **红色警示模态框 (Modal)**。
    *   **标题**："警告！您正在取消会诊任务！" (搭配 Alert 图标)。
    *   **内容**："取消后任务将移入历史列表，确定继续吗？"
    *   **按钮**：`暂不取消` (主操作) | `确认取消` (警示色，需3秒倒计时防误触)。
*   **已会诊列表**：仅提供`【查看详情】`操作，点击进入只读归档视图。

### 3.2 会诊任务创建与编辑
#### 3.2.1 页面结构 (分步长表单)
采用 **左侧锚点导航 + 右侧长滚动表单** 布局，或 **分步向导** 形式。

*   **区域一：基础信息**
    *   字段：`姓名`、`性别` (Radio)、`年龄` (Input)、`主诉` (Textarea)。
*   **区域二：详细病史 (折叠面板)**
    *   **必填项**：`现病史`、`目前治疗方案`、`本次会诊目的` (默认展开)。
    *   **选填项**：`既往史`、`家族史` 等 (默认折叠/紧凑显示)。
    *   **快捷操作**：提供“一键填充模板”按钮。
*   **区域三：专家调度 (核心交互)**
    *   **布局**：左右分栏设计。
        *   **左栏：专家选择器** (支持搜索、按科室筛选、多选Checkbox)。
        *   **右栏：AI智能推荐面板** (实时动态)。

#### 3.2.2 AI专家推荐交互
*   **触发机制**：当`主诉/现病史`输入停止超过1秒，或字段失焦时触发。
*   **推荐展示**：
    *   **标签云**：显示推荐的专家类型 (如 "精神科", "心理治疗")。
    *   **视觉联动**：
        *   **正反馈**：当助理在左侧勾选了属于推荐类型的专家时，右侧对应标签变为**高亮/打钩**状态。
        *   **缺口提示**：若推荐了"心理治疗"但未勾选相关专家，该标签保持灰色或闪烁提示。

#### 3.2.3 邀请与撤回
*   **发送邀请**：保存任务时自动发送。
*   **撤回邀请 (编辑模式)**：
    *   **列表展示**：已选专家以Tag形式罗列，带 "x" 删除按钮。
    *   **状态差异化删除**：
        *   删除 `未响应/已拒绝` 专家 -> 简单Toast提示 "已移除"。
        *   删除 `已接受` 专家 -> **弹窗警告**："警告！该专家已接受邀请，移除将发送取消通知！"

### 3.3 专家库管理
#### 3.3.1 注册审核列表
*   **列表样式**：类似邮件待办列表。
*   **审核卡片**：
    *   显示：`姓名`、`科室`、`申请时间`。
    *   **签名预览**：缩略图显示提交的电子签名，点击可放大查看（检查清晰度）。
    *   **操作**：
        *   `【通过】` (绿色)：点击后该行消失，专家入库。
        *   `【驳回】` (红色)：弹出输入框填写驳回原因。

#### 3.3.2 专家类型管理
*   **交互形式**：可编辑标签页 (Tag Editor)。
*   **操作**：
    *   **新增**：输入框 + `+` 号按钮。
    *   **删除**：Hover标签显示 `x`，点击删除 (若有专家关联则禁止删除).

## 4. 核心会诊详情页 (助理端) 交互设计

> **设计原则**：采用 **分步解锁 (Step-by-Step)** 模式，降低因流程复杂带来的认知负荷。
> *   **状态共享**：顶部的阶段状态条需与专家端保持毫秒级同步。

### 4.1 页面整体框架
*   **顶部导航栏 (Sticky)**：
    *   **左侧**：返回按钮 + 患者姓名/ID。
    *   **中部 (阶段指示器)**：
        *   Step 1: 准备中 (Tab1)
        *   Step 2: 问诊中 (Tab2)
        *   Step 3: 文书/意见生成 (Tab3 & Tab4)
        *   Step 4: 报告生成 (Tab5)
    *   **右侧**：当前在线专家头像组 (Tooltip显示连接状态)。
*   **Tab内容区**：
    *   5个Tab横向排列，**仅当前及之前阶段的Tab可点击**。
    *   **图标状态**：
        *   🔓 (解锁/激活)：高亮色，可点击。
        *   🔒 (锁定)：灰色，鼠标Hover提示“需完成上一阶段任务后解锁”。

### 4.2 [Tab1] 会诊前文书 (准备态)
*   **布局**：单栏阅读模式，类似电子病历阅览。
*   **核心内容**：
    *   **病史信息**：分组展示（基础信息、现病史等）。
    *   **虚拟专家意见 (AI)**：
        *   位于页面底部，Card样式，浅蓝色背景。
        *   标题：“AI预分析建议（基于临床指南）”。
        *   内容：结构化的诊断/治疗建议，供会诊参考。
*   **关键交互 (Call to Action)**：
    *   页面右上角悬浮 **【开始会诊】** 强引导按钮。
    *   **点击效果**：
        1.  触发系统状态变更 -> "会诊中"。
        2.  Tab2 解锁。
        3.  页面平滑滚动/切换至 Tab2。

### 4.3 [Tab2] 专家问诊 (现场执行态)
*   **视图结构**：左右分栏 (左40% : 右60%)。
*   **【左侧】实时ASR转录流**：
    *   **界面**：黑底/深色背景，模拟终端效果，文字逐字上屏。
    *   **录音控制悬浮条** (底部居中)：
        *   大号圆形按钮：`开始` / `暂停` (切换时带声纹动画)。
        *   计时器：显示当前录音时长。
        *   辅助按钮：`静音`、`标记关键点`。
*   **【右侧】智能对话生成流**：
    *   **生成机制**：每当录音暂停或静音超过N秒，插入一条新的“对话卡片”。
    *   **对话卡片 (Card)**：
        *   **角色区分**：医生 (图标D) vs 患者 (图标P).
        *   **内容**：经过AI清洗、去口语化的文本。
        *   **编辑交互**：Hover卡片显示【编辑】图标，点击后变为 `Textarea`，支持修正识别错误。
*   **阶段结束交互**：
    *   底部固定栏：**【提交对话 & 进入下一阶段】**。
    *   **确认逻辑**：弹窗提示“确定问诊结束吗？提交后将生成会诊文书。” (二次确认)。

### 4.4 [Tab3] 会诊后文书 (编辑态)
*   **布局**：**对照编辑模式**。
    *   **左屏 (参考源)**：只读展示 Tab2 的问诊记录 (支持搜索/高亮)。
    *   **右屏 (文书编辑器)**：AI生成的结构化表单。
*   **字段级交互**：
    *   **AI生成标识**：AI生成的内容字段带有 "✨" 图标。
    *   **选填项控制**：
        *   每个选填字段右上角仅有 `👁️` (隐藏/显示) 按钮。
        *   点击隐藏 -> 字段收起，仅留标题行，不在最终报告中展示。
*   **提交交互**：
    *   **暂存**：自动保存草稿。
    *   **【提交标星版本】**：此操作将当前版本同步给专家端可见。

### 4.5 [Tab4] 专家意见 (主持人总控态)
*   **场景描述**：助理作为主持人，控制那个专家正在发言（分配麦克风）。
*   **专家卡片矩阵**：
    *   每个参会专家对应一张卡片。
    *   **状态设计**：
        *   `待发言`：灰色，麦克风图标静止。
        *   `发言中`：**卡片放大/高亮**，绿色呼吸灯效，实时显示ASR字幕。**互斥逻辑**：同一时间只能有一个专家处于“发言中”。
        *   `已记录`：显示 "已生成结构化意见"，支持展开查看/编辑。
*   **意见修正**：
    *   助理可手动编辑ASR识别错误的文字。
    *   若专家已在自己端提交了修改，卡片显示标签“专家已修订”。

### 4.6 [Tab5] 会诊报告 (终审态)
*   **所见即所得 (WYSIWYG) 预览**：
    *   以A4纸比例展示最终PDF样式。
*   **签名墙**：
    *   页面底部网格展示收集到的专家签名。
    *   **缺失提示**：若某专家未签名，显示虚线框占位，并提供【一键提醒】按钮 (发送系统通知)。
*   **【会诊结束 & 归档】**：
    *   最终提交操作，点击后全站状态变更为“已会诊”。

## 5. 专家工作台 (PC/Pad Web) 交互设计

> **设备兼容性**：优先适配 iPad (横屏) 及 PC 浏览器，触控热区需适当放大。

### 5.1 注册与电子签名
*   **流程**：基础信息填写 -> 资质上传 -> **电子签名采集**。
*   **签名画板组件**：
    *   **界面**：大面积空白画布，背景为签字下划线。
    *   **工具栏**：
        *   `画笔` (默认黑色，压感模拟)。
        *   `重写` (清空画布)。
        *   `确认使用` (生成透明PNG并上传)。
    *   **移动端适配**：在PC端注册时，提供“扫码在手机上手写”功能，提升签名便利性。

### 5.2 工作台首页 (看板视图)
*   **头部概览**：显示“今日会诊场次”及“待处理邀请”。
*   **任务卡片流**：
    *   **待响应邀请 (高优先级)**：
        *   样式：带有强烈的阴影或边框高亮。
        *   **操作**：
            *   `【接受邀请】` (大号蓝色按钮)。
            *   `【拒绝】` (文字按钮，点击弹出红色警示窗，需填写拒绝理由)。
    *   **待会诊 (已接受)**：
        *   显示倒计时 (如 "距离开始还有 2小时")。
        *   点击进入【会诊前文书】预览。
    *   **历史记录**：仅展示简略信息，点击查看归档详情。

### 5.3 专家详情页 (限制视图)
*   **Tab差异化配置**：
    *   仅显示：`会诊前文书` | `会诊后文书` (初始锁) | `我的意见` | `会诊报告` (初始锁)。
    *   **隐形Tab**：`专家问诊`Tab对专家不可见。

#### 5.3.1 核心交互：[Tab] 我的意见
此页面为专家工作台的核心，支持**AI辅助创作**。
*   **布局**：左右分栏。
    *   **左侧：意见编辑器**：
        *   富文本/纯文本输入框。
        *   **初始内容**：预置ASR转录并清洗后的初步意见 (若助理已记录)。
    *   **右侧：AI智能建议 (Copilot)**：
        *   **推荐条目**：AI根据病历和对话生成的结构化建议点 (如 "建议增加药物XX剂量")。
        *   **交互-采纳**：
            *   每个条目旁有 `+` 按钮。
            *   点击 `+` -> 文本自动追加到左侧编辑器光标处。
            *   已采纳条目变灰或打钩。
*   **查看他人意见**：
    *   页面底部或侧边提供 **"参考其他专家意见"** 折叠面板。
    *   点击展开可阅读同场其他专家的已提交意见。

#### 5.3.2 会诊报告确认
*   **预览**：查看最终合成的报告。
*   **签名确认**：
    *   即时当前页面显示了自己的签名图片，仍需点击 **【确认签署】** 按钮作为法律效应的确认。

## 6. 特殊场景交互

### 6.1 WebSocket实时协同与状态同步
*   **强制跳转 (主持人控场)**：
    *   **场景**：当助理点击【提交问诊】进入下一阶段时。
    *   **专家端反馈**：
        *   顶部出现倒计时Toast（橙色背景）："主持人已进入下一阶段，3秒后自动跳转至[专家意见]..."
        *   倒计时结束：页面无刷新平滑切换至目标Tab。
*   **内容同步**：
    *   **场景**：助理修改了【会诊后文书】并点击【提交标星】。
    *   **专家端反馈**：
        *   若专家正停留在【会诊文书】Tab：内容即时刷新，并提示 "内容已更新"。
        *   若专家在其他Tab：Tab标签出现红点提示。

### 6.2 异常状态处理
*   **ASR服务中断/弱网**：
    *   **助理端表现**：
        *   录音波形图变平/变灰。
        *   弹出顶部通告条（红色）："网络连接不稳定，ASR转录可能延迟。录音仍在本地缓存。"
        *   **兜底策略**：允许助理继续录音，网络恢复后后台自动上传并补全转录文字，或提示“转储为本地音频文件”。
*   **任务超时/被取消**：
    *   **场景**：专家正在查看详情，但助理在后台取消了该任务。
    *   **交互**：专家端弹出模态框 "该会诊任务已被取消/删除"，点击【返回首页】强制退出详情页。

### 6.3 移动端(iPad) 响应式策略
*   **布局调整**：
    *   **导航栏**：收折为汉堡菜单。
    *   **分栏视图**：
        *   PC端为左右分栏 (如 文书对照)。
        *   Pad端在竖屏下自动堆叠为上下结构；横屏下保持左右分栏但调整比例为 (30%:70%)。
*   **触控优化**：
    *   所有按钮高度不小于 `44px`。
    *   签名板支持多指防误触 (Palm Rejection)。

## 7. 视觉风格与规范建议
### 7.1 字体与排版
*   **中文字体**：优先使用 `PingFang SC`, `Microsoft YaHei`。
*   **数字/西文**：`Roboto`, `San Francisco`。
*   **字号阶梯**：
    *   H1/页面标题: 24px
    *   H2/区块标题: 18px (加粗)
    *   正文: 14px
    *   辅助文字: 12px (灰色)

### 7.2 色彩系统
*   **品牌色/主色**：`#1890FF` (医疗蓝, 用于主按钮、选中状态).
*   **功能色**：
    *   成功/进行中: `#52C41A` (绿色, 录音中, 已完成).
    *   警示/拒绝: `#FF4D4F` (红色, 醒目警告, 拒绝).
    *   链接/信息: `#1890FF` (蓝色).
    *   失效/锁定: `#BFBFBF` (灰色).

### 7.3 图标体系
*   采用线性图标 (Outline) 为主，选中状态使用面性图标 (Filled)。
*   **关键业务图标**：
    *   🎤 (麦克风): 录音控制核心，需配合声纹动效。
    *   📄 (文档): 文书类Tab。
    *   🔒/🔓 (锁): 阶段解锁状态。
    *   ✍️ (笔): 签名与编辑。

